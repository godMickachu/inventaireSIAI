<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
        <link href="./style/style.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="./ressource/BYES.png" />
        
        <script type="text/javascript">

             var objRequete = new XMLHttpRequest;

             function fRetour() {
				if (objRequete.readyState==4 && objRequete.status==200) { 
                    try {
                        obj=JSON.parse(objRequete.responseText);
                        tableCreate();
                    } catch (e) {
                        alert("pb parsing. Voir l'erreur dans la console si possible");
                        console.error("Parsing error:-( :", e);
                    }
				}
			}
			
			function fAction() {
                    var param = document.getElementById('recherche').value;
					objRequete.open('get','./API_ListeMat.php?recherche='+String(param.toUpperCase()),true);	
                    objRequete.onreadystatechange = fRetour;		
                    objRequete.send(null);									
					return true; 
			 }

             function tableCreate() {
                try{
                    var trs = document.getElementsByTagName('tr');
                    for(var i=0;i=trs.length;i++){
                        var oldtr = document.querySelector("[class='jstr']");   
                        oldtr.remove();   
                    }                            
                }catch{
                    console.log("Aucune référence correspondante dans la BDD");
                }
                var tbl = document.getElementById('tableauref');
                tbl.style.width = '50%';
                tbl.setAttribute('border', '1');
                for (var i = 0; i < obj.length; i++) {
                    var tr = document.createElement('tr');
                    tr.setAttribute('class', 'jstr');
                    for (var j = 0; j < 3; j++) {
                        var td = document.createElement('td');;
                        td.appendChild(document.createTextNode(obj[i][j]));
                        tr.appendChild(td);  
                    }
                    tbl.appendChild(tr);
                }
                }
        </script>
	</head>
	<body onload="fAction();">
			<h1>Inventaire du SIAI</h1>
            <div id="global">
                <a href="./ajtMat.php">Ajouter matériel</a>
                <input type="text" id="recherche" size="30">
                <button onclick="fAction();">Rechercher</button>
                <a href="./rtrMat.php">Retirer matériel</a>
            </div>
            <br><br>
			<Table Border=1 class="tabcenter" id="tableauref">
				<tr>
					<th><b>Marque</b></th>
                    <th><b>Reference</b></th>
                    <th><b>Quantite</b></th>
                </tr>
                <tr>
                    <td class="jstr">Cette référence ne correspond à rien dans la BDD.</td>
                </tr>
			</table>
	</body>
</html>