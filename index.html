<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
        <link href="./style/style.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="./ressource/BYES.png" />
        
        <script type="text/javascript">

             var objRequete = new XMLHttpRequest;

             function fRetour() {
				if (objRequete.readyState==4 && objRequete.status==200) { 
                    try {
                        obj=JSON.parse(objRequete.responseText);
                        tableUpdate();
                    } catch (e) {
                        alert("pb parsing. Voir l'erreur dans la console si possible");
                        console.error("Parsing error:-( :", e);
                    }
				}
			}
			
			function fAction() {
                    var param = document.getElementById('recherche').value;
					objRequete.open('get','./API_ListeMat.php?recherche='+String(param.toUpperCase()),true);	
                    objRequete.onreadystatechange = fRetour;		
                    objRequete.send(null);									
					return true; 
			 }

             function tableUpdate() {
                try{
                    var trs = document.getElementsByTagName('tr');
                    for(var i=0;i=trs.length;i++){
                        var oldtr = document.querySelector("[class='jstr']");   
                        oldtr.remove();   
                    }                            
                }catch{
                    console.log("Aucune référence correspondante dans la BDD");
                }
                var tbl = document.getElementById('tableauref');
                tbl.style.width = '50%';
                tbl.setAttribute('border', '1');
                for (var i = 0; i < obj.length; i++) {
                    var tr = document.createElement('tr');
                    tr.setAttribute('class', 'jstr');
                    for (var j = 0; j < 5; j++) {
                        var td = document.createElement('td');
                        if(j == 0 ){
                            test = document.createElement('a');
                            test.innerText = "click"+obj[i][4];
                            test.setAttribute('href', "./det.php?id_materiel="+obj[i][4]);
                            td.appendChild(test);
                            tr.appendChild(td);  
                        }else{
                            td.appendChild(document.createTextNode(obj[i][j-1]));
                            tr.appendChild(td);  
                        }
                    }
                    tbl.appendChild(tr);
                }
                }
        </script>
	</head>
	<body onload="fAction();">
        <section style="background: lightblue; color: rgba(0, 0, 0, 0.5);">
            <nav class="shift">
                <ul>
                <li><a href="./ajtMat.php">Ajouter</a></li>
                <li><a href="./">Accueil</a></li>
                <li><a href="./rtrMat.php">Retirer</a></li>
                <li><a href="#">Historique</a></li>
                </ul>
            </nav>
        </section>
			<h1>Inventaire du SIAI (étagères du grenier)</h1><br>
            <div id="global">
                <input type="text" id="recherche" size="30">
                <button onclick="fAction();">Rechercher</button>
            </div>


            
            <br><br>
			<Table Border=1 class="tabcenter" id="tableauref">
				<tr>
                    <th><b>Détail</b></th>
                    <th><b>Designation</b></th>
					<th><b>Marque</b></th>
                    <th><b>Reference</b></th>
                    <th><b>Quantite</b></th>
                </tr>
                <tr>
                    <td class="jstr">Cette référence ne correspond à rien dans la BDD.</td>
                </tr>
			</table>
	</body>
</html>